Agentic WCAG Compliance Platform
Stack: Next.js 14 (App Router) + TypeScript + Supabase (Postgres + Auth + Storage) + Puppeteer + axe-core
Runtime: Node 20  Deploy: Railway (Docker)  Integrations: HubSpot, Gmail
Folder Map
repo/
├─ app/                     # Next.js App Router
│  ├─ (auth)/               # Route groups for auth-gated pages
│  ├─ (public)/             # Public pages (marketing, pricing)
│  ├─ api/                  # API routes (REST-ish)
│  │  ├─ scan/route.ts      # POST /api/scan  – axe-core + Puppeteer
│  │  ├─ webhook/hs/route.ts# HubSpot webhook handler
│  │  └─ webhook/gmail/route.ts# Gmail push handler
│  ├─ dashboard/            # Auth-only scan history + re-scan
│  ├─ layout.tsx            # Root layout (Nav, UserNav, ThemeProvider)
│  └─ globals.css           # Tailwind + custom dark theme
├─ components/              # Shadcn/ui wrappers
│  ├─ ui/                   # Button, Card, Progress… (shadcn)
│  ├─ scan/                 # ScanFrame, ProgressBar, ViolationList
│  ├─ marketing/            # Hero, Pricing, Footer
│  └─ providers/            # SupabaseProvider, ThemeProvider
├─ lib/
│  ├─ supabase/             # Typed client + server clients
│  ├─ scan/                 # Puppeteer launcher, axe runner
│  ├─ integrations/         # HubSpot SDK wrapper, Gmail SDK wrapper
│  └─ utils/                # cn(), sleep(), rate-limit
├─ hooks/                   # useScan(), useTheme(), useUser()
├─ types/                   # DB row types (generated by Supabase CLI)
├─ prisma/                  # Not used – we use Supabase CLI
├─ supabase/                # Migrations + seed.sql
├─ .env.local.example       # Template env vars
├─ Dockerfile               # Railway build
├─ railway.yaml             # Health-check config
└─ README.md                # One-click deploy button

Key Services & State Ownership
Concern    Owner (single source of truth)
Auth / user rows    Supabase auth.users
Scan meta + results    public.scans table
UI theme    next-themes (cookie)
Rate-limit counters    Redis (Upstash via Railway)
File assets (PDF reports)    Supabase Storage bucket
Background jobs    Github Actions cron (for now)
Data Flow (happy path)
1.  User clicks “Scan” → useScan() POSTs {url} to /api/scan
2.  API route:
a. Rate-limit check (Redis)
b. Launch Puppeteer in Docker (chrome-aws-lambda)
c. Inject axe-core → collect violations
d. Insert row into public.scans (user_id, url, violations JSONB)
e. Push contact to HubSpot (if email supplied)
f. Queue Gmail PDF report (Google OAuth)
3.  Front-end polls /api/scan/[id]/status → shows progress bar → displays violation cards
4.  User can download PDF (edge function streams Supabase Storage file)
Auth Strategy
•  Supabase magic-link + Google OAuth
•  Row Level Security (RLS) on scans table: auth.uid() = user_id
•  Public pages statically rendered; dashboard SSR with authenticated cookie
Env Vars (local & Railway)
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
REDIS_URL=
HUBSPOT_ACCESS_TOKEN=
GMAIL_CLIENT_ID=
GMAIL_CLIENT_SECRET=
GMAIL_REFRESH_TOKEN=

Testing Strategy
•  Unit: Vitest for pure fns (lib/utils)
•  Integration: Playwright against staging URL (GitHub Action)
•  e2e smoke: scan https://example.com → expect 0 violations, row inserted, PDF exists
